# CLAUDE.md - ToDoリストアプリケーションのAIアシスタントガイド

## プロジェクト概要

これは、vanilla JavaScript、HTML5、Tailwind CSSで構築されたシンプルなクライアントサイドのみのToDoリストWebアプリケーションです。データの永続化には`localStorage`を使用し、バックエンドサーバーやビルドプロセスは不要です。

**言語**: 日本語（UIとドキュメント）
**種類**: 教育/デモンストレーションプロジェクト
**ステータス**: 開発中

## クイックスタート

1. ブラウザで`login.html`を開く
2. デフォルト認証情報：ユーザー名 `user`、パスワード `pass`
3. ビルドツール、パッケージマネージャー、サーバーは不要

## アーキテクチャ

### 技術スタック

- **HTML5**: 日本語対応のセマンティックマークアップ（`lang="ja"`）
- **JavaScript ES6**: モダンな構文を使用したVanilla JavaScript
- **Tailwind CSS**: CDN経由（https://cdn.tailwindcss.com）
- **ストレージ**: データ永続化にブラウザの`localStorage`を使用

### アプリケーションタイプ

- **クライアントサイドのみ**: バックエンド、API、データベースなし
- **マルチページアプリケーション（MPA）**: ページ遷移時にリロードする3つの独立したHTMLファイル
- **状態管理**: `localStorage`が唯一の真実の情報源として機能

### データフロー

```
ユーザーアクション → JavaScript関数 → localStorage → DOMの再レンダリング
                                      ↓
                              セッション間で永続化
```

## ファイル構成

```
todo-list/
├── login.html              # ログインページ
├── todolist.html           # ToDo一覧ビュー（メインページ）
├── edit.html               # ToDo作成/編集フォーム
├── js/
│   └── app.js              # すべてのJavaScriptロジック（192行）
├── .github/
│   └── copilot-instructions.md   # GitHub Copilot AIガイド
├── .gemini/
│   └── styleguide.md             # Gemini AIガイド（日本語応答）
├── README.md               # ユーザー向けドキュメント（日本語）
└── CLAUDE.md              # このファイル（Claude AIガイド）
```

### HTMLファイル

すべてのHTMLファイルは共通のパターンを持っています：
- UTF-8エンコーディングと日本語サポート
- レスポンシブなviewportメタタグ
- `<head>`内にTailwind CSS CDN
- `</body>`の直前に`js/app.js`をインポート
- Tailwindユーティリティクラスを使用したクリーンでセマンティックなマークアップ

**login.html**
- シンプルな中央寄せのログインフォーム
- ユーザー名とパスワードの入力欄（両方必須）
- エラーメッセージコンテナ（デフォルトで非表示）
- フォームID: `loginForm`

**todolist.html**
- タイトルとログアウトボタンを含むヘッダー
- `edit.html`へのリンク「新規作成」ボタン
- 空の`<ul id="todoList">`コンテナ（JavaScriptで生成）

**edit.html**
- ToDo作成/編集用の中央寄せフォーム
- タイトル入力（必須）と詳細テキストエリア（任意）
- フォームID: `todoForm`
- クエリパラメータ`?idx=N`は編集モードを示す

## JavaScriptアーキテクチャ（app.js）

### コード構成

`app.js`ファイルは論理的なセクションに分かれています：

1. **認証関数**（5-25行目）
2. **データ管理関数**（27-35行目）
3. **ページ初期化**（37-103行目）
4. **レンダリングとアクション**（105-191行目）

### 主要な関数

#### 認証

```javascript
checkLogin()
```
- `localStorage.getItem('todo_login') === '1'`を検証
- 認証されていない場合、`login.html`にリダイレクト
- 保護されたページの読み込み時に呼び出される

```javascript
login(username, password)
```
- **ハードコードされた認証情報**: `user` / `pass`
- 成功時に`true`、失敗時に`false`を返す
- `localStorage.setItem('todo_login', '1')`を設定
- **セキュリティ注意**: 本番環境には不適切

```javascript
logout()
```
- localStorageから`todo_login`を削除
- `login.html`にリダイレクト

#### データ管理

```javascript
getTodos()
```
- `localStorage.getItem('todos')`からパース済み配列を返す
- データが存在しない場合は空配列`[]`をデフォルトとする
- **場所**: js/app.js:29

```javascript
saveTodos(todos)
```
- 配列を文字列化して`localStorage.setItem('todos', ...)`に保存
- **場所**: js/app.js:33

#### ページ固有のロジック

アプリは単一のDOMContentLoadedイベントリスナーを使用し、特定のDOM要素の存在に基づいて実行するページロジックを決定します：

**ログインページ**（50-64行目）
- `#loginForm`を検出
- フォーム送信を処理
- ログイン失敗時にエラーメッセージを表示
- 認証チェックをスキップして早期に戻る

**編集ページ**（72-96行目）
- `#todoForm`を検出
- 編集モード用の`?idx=`クエリパラメータを読み取り
- 既存のToDoを編集する場合、フォームフィールドを事前入力
- 更新時に`checked`プロパティを保持
- 保存後、`todolist.html`にリダイレクト

**ToDo一覧ページ**（99-102行目）
- `#todoList`を検出
- `renderTodos()`を呼び出してリストを生成

#### レンダリングとアクション

```javascript
renderTodos()
```
- `#todoList` DOMをクリアして再構築
- プログラム的に要素を作成（ユーザーデータにinnerHTMLを使用しない）
- **セキュリティ**: XSS防止のため`innerHTML`の代わりに`textContent`を使用
- チェックボックスと削除ボタンにイベントリスナーを追加
- 空の場合は「ToDoがありません。」を表示
- **場所**: js/app.js:109

```javascript
toggleCheck(idx)
```
- インデックスのToDoの`checked`ブール値を切り替え
- 保存して再レンダリング
- **場所**: js/app.js:176

```javascript
deleteTodo(idx)
```
- 確認ダイアログを表示：「本当に削除しますか？」
- `Array.splice(idx, 1)`を使用して削除
- 保存して再レンダリング
- **場所**: js/app.js:185

## データ構造

### localStorageキー

| キー | 型 | 説明 |
|-----|------|-------------|
| `todo_login` | String | 認証フラグ（`'1'` = ログイン済み） |
| `todos` | JSON String | ToDoオブジェクトのシリアライズされた配列 |

### ToDoオブジェクトスキーマ

```javascript
{
  title: String,    // 必須。ToDoタイトル/名前
  detail: String,   // 任意。追加の詳細
  checked: Boolean  // 完了ステータス（デフォルト: false）
}
```

**例**:
```javascript
[
  {
    title: "買い物に行く",
    detail: "牛乳、卵、パンを買う",
    checked: false
  },
  {
    title: "レポート提出",
    detail: "",
    checked: true
  }
]
```

## コーディング規約

### JavaScriptスタイル

- **ES6構文**: アロー関数、テンプレートリテラル、分割代入
- **セミコロンなし**: 任意（このプロジェクトでは一貫して使用）
- **DOM操作**:
  - 要素選択には`document.getElementById()`を使用
  - `document.createElement()`で要素を作成
  - ユーザー生成コンテンツには`textContent`を使用（`innerHTML`は使用しない）
- **イベント処理**:
  - インライン`onclick`属性よりも`addEventListener()`を優先
  - DOMContentLoadedコールバックまたはレンダリング中にリスナーを追加
- **エラー処理**: 最小限（ブラウザのデフォルトに依存）

### セキュリティプラクティス

✅ **コードが適切に行っていること**:
- ユーザーデータをレンダリングする際にXSSを防ぐために`textContent`を使用
- `eval()`や危険なパターンを使用していない

⚠️ **既知の制限事項**（デモ/学習プロジェクトとして許容）:
- ソースコード内にハードコードされた認証情報
- CSRF保護なし（クライアントサイドのみなので該当なし）
- 入力のサニタイゼーションなし（textContentに依存）
- 認証状態がプレーンなlocalStorageに保存

### HTML/CSSパターン

- **Tailwindクラス**: ユーティリティファーストのアプローチ
- **レスポンシブ**: Tailwindレスポンシブユーティリティとflexboxを使用
- **アクセシビリティ**: 基本的なフォームラベルのみ、改善の余地あり
- **クラス命名**: Tailwindユーティリティのみ（カスタムCSSなし）

## 開発ワークフロー

### 変更を加える

1. **HTML/JSファイルを直接編集** エディタで編集
2. **ブラウザをリフレッシュ** 変更を確認（ビルドステップなし）
3. **手動テスト** ブラウザDevToolsで実施
4. **明確なメッセージでコミット** （下記のGit規約を参照）

### デバッグ

- **コンソールログ**: `console.log()`文を追加
- **DevTools**:
  - Applicationタブ → Local Storageでデータを検査
  - Consoleでエラーを確認
  - Elementsタブで DOM を検査
- **Networkタブ**: CDNリソースが正しく読み込まれているか確認

### テスト戦略

**現在の状態**: 自動テストなし

**手動テストチェックリスト**:
- [ ] 正しい認証情報でログイン
- [ ] 間違った認証情報でログイン（エラー表示を確認）
- [ ] 新しいToDoを作成
- [ ] 既存のToDoを編集
- [ ] ToDoの完了を切り替え
- [ ] ToDoを削除
- [ ] ログアウトしてセッションがクリアされることを確認
- [ ] 空のlocalStorageでテスト
- [ ] 複数のToDoでテスト

**将来の推奨事項**:
- JestまたはVitestによるユニットテスト
- PlaywrightまたはCypressによるE2Eテスト
- axe-coreによるアクセシビリティテスト

## Git規約

### ブランチ命名

- **機能ブランチ**: AIアシスタント作業の場合は`claude/`で始める
- **メインブランチ**: 安定したコードのデフォルトブランチ
- 常に指定された機能ブランチで開発

### コミットメッセージ

**履歴で観察されたパターン**:
- 日本語のコミットメッセージ
- 説明的で簡潔
- 例:
  - "GeminiCodeAssistのプルリクエストレビューの日本語化設定を追加"
  - "READMEを追加"
  - "カスタムインストラクションの追加"

**ベストプラクティス**:
- 明確で説明的なメッセージを書く
- 日本語を使用（既存のパターンに合わせる）
- 「どのように」よりも「何を」「なぜ」に焦点を当てる

### ワークフロー

1. 機能ブランチで変更を加える
2. ブラウザで徹底的にテスト
3. 説明的なメッセージでコミット
4. リモートにプッシュ: `git push -u origin <branch-name>`
5. 準備ができたらプルリクエストを作成

## AIアシスタントの一般的なタスク

### 新機能の追加

1. **最初に既存のコードを読む**: 現在の実装を理解せずに変更を提案しない
2. **既存のパターンに従う**: app.jsのスタイルに合わせる
3. **必要に応じてデータ構造を更新**: localStorageのToDoオブジェクトスキーマを変更
4. **ブラウザでテスト**: 機能がエンドツーエンドで動作することを確認
5. **ドキュメントを更新**: アーキテクチャが変更された場合、このCLAUDE.mdファイルを修正

### リファクタリングガイドライン

⚠️ **過剰なエンジニアリングを避ける**:
- 明示的に要求されていない機能を追加しない
- 依頼されない限りTypeScript、バンドラー、フレームワークを追加しない
- 起こりえないシナリオのための過剰なエラー処理を追加しない
- シンプルに保つ - これは学習/デモプロジェクト

✅ **良いリファクタリング**:
- 繰り返されるコードを関数に抽出
- アクセシビリティを改善（ARIAラベル、キーボードナビゲーション）
- 複雑なロジックに意味のあるコメントを追加
- セキュリティを改善（入力検証、デプロイする場合はCSPヘッダー）

### バグ修正ワークフロー

1. **バグを再現**: 最初にブラウザでテスト
2. **根本原因を特定**: DevToolsデバッガーを使用
3. **最小限の修正を行う**: 必要な部分のみ変更
4. **修正を検証**: 特定のシナリオをテスト
5. **リグレッションをチェック**: 関連機能をテスト

### コードレビューの考慮事項

コードをレビューまたは変更する際に確認すべき点：
- **XSS脆弱性**: ユーザー入力が`innerHTML`ではなく`textContent`を使用していることを確認
- **インデックス境界**: `todos[idx]`での配列アクセスの存在を確認
- **データの一貫性**: localStorageがUIと同期していることを確認
- **日本語**: UIテキストは日本語を維持
- **Tailwindクラス**: 既存のユーティリティパターンに従う
- **ブラウザ互換性**: モダンブラウザでテスト（Chrome、Firefox、Safari）

## 重要な注意事項

### やってはいけないこと

- ❌ バックエンド/APIエンドポイントを追加しない（プロジェクトはクライアントサイドのみ）
- ❌ 特に要求されない限りビルドツール（Webpack、Viteなど）を追加しない
- ❌ 明示的な要求なしにSPAフレームワーク（React、Vue）に変換しない
- ❌ データベースを追加しない（プロジェクトは意図的にlocalStorageを使用）
- ❌ 日本語を削除しない（UIは意図的に日本語）
- ❌ テストなしにCDNの代替を追加しない（Tailwind CSS CDNが必要）

### 認識すべき制限事項

- **localStorageの制限**: ブラウザによって約5-10MB
- **ユーザー分離なし**: すべてのユーザーが同じブラウザストレージを共有
- **同期なし**: データは1つのブラウザにローカル
- **ハードコードされた認証**: 認証情報がソースコード内（本番環境には不適切）
- **検証なし**: title/detailに任意の文字列入力を受け入れる

## デプロイ

### 現在の状態

デプロイ設定は存在しません。アプリはファイルシステムから直接実行されます。

### 潜在的なデプロイオプション

デプロイが要求された場合：

1. **GitHub Pages**:
   - 静的ホスティング（無料）
   - このプロジェクトに最適
   - ビルドステップ不要

2. **Netlify/Vercel**:
   - ドロップイン静的ホスティング
   - 設定不要

3. **シンプルHTTPサーバー**:
   - `python -m http.server`
   - `npx serve`

**注意**: バックエンドがないため、すべてのオプションが機能します。

## AIアシスタント間の連携

### 他のAIアシスタントガイド

このプロジェクトには複数のAIアシスタント向けガイドが含まれています：

- **.github/copilot-instructions.md**: GitHub Copilot（包括的、英語）
- **.gemini/styleguide.md**: Gemini Code Assist（日本語応答を要求）
- **CLAUDE.md**: このファイル（Claude Code）

### 連携ガイドライン

他のAIアシスタントや開発者と作業する場合：
- README.mdや他のAIガイドを読んで期待事項を理解する
- 確立されたパターンとの一貫性を維持
- UIの日本語を保持
- プロジェクトをシンプルで焦点を絞った状態に保つ

### コミュニケーションスタイル

- **簡潔に**: ユーザーはCLI環境で作業している
- **コード参照を使用**: `file_path:line_number`の形式
- **推測を避ける**: 変更を提案する前にコードを読む
- **不確かな場合は質問**: 実装前に要件を明確にする

## トラブルシューティング

### よくある問題

**問題**: ログインが動作しない
**解決策**: ブラウザコンソールでエラーを確認。`js/app.js`が読み込まれているか確認。

**問題**: リフレッシュ後にToDoが消える
**解決策**: DevTools → Application → Local Storageを確認。`todos`キーが存在するか確認。

**問題**: スタイルが読み込まれない
**解決策**: インターネット接続を確認（Tailwind CSSはCDN経由）。Networkタブを確認。

**問題**: 既存のToDoを編集できない
**解決策**: URLに`?idx=N`パラメータがあるか確認。コンソールでエラーを確認。

**問題**: 変更が表示されない
**解決策**: ブラウザをハードリフレッシュ（Ctrl+Shift+R / Cmd+Shift+R）してキャッシュをクリア。

## 変更履歴

### 2025-11-28
- AIアシスタント向けの包括的なCLAUDE.mdガイドを作成
- すべての関数、データ構造、ワークフローを文書化
- コーディング規約と一般的なタスクを確立
- ドキュメント全体を日本語に翻訳

---

**最終更新**: 2025-11-28
**メンテナンス**: このリポジトリで作業するAIアシスタント
**質問？**: ユーザー向けドキュメントはREADME.md、実装の詳細はapp.jsを参照してください
